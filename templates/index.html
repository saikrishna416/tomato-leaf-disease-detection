<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tomato Leaf Disease Detection</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <style>
        .btn-primary {
            background: #007bff;
            color: #fff;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
        }
        .btn-secondary {
            background: #f1f3f5;
            color: #212529;
            border: 1px solid #dfe3e6;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }
        .action-row { display:flex; gap:8px; align-items:center; margin-top:8px; }

        .slider-fixed {
            position: sticky;
            top: 20px;
            width: 420px;
            max-width: 48vw;
            height: 420px;
            margin-left: 20px;
            flex: 0 0 420px;
            align-self: start;
            border-radius: 8px;
            overflow: hidden;
            background: #111;
            box-shadow: 0 6px 18px rgba(0,0,0,0.2);
        }

        .slider-track { position: relative; width:100%; height:100%; }
        .slider-track img {
            position:absolute;
            inset:0;
            width:100%;
            height:100%;
            object-fit:cover;
            opacity:0;
            transition:opacity 600ms ease;
        }
        .slider-track img.active { opacity:1; }

        .file-input { display:none !important; }

        .file-select-btn {
            display:inline-block;
            cursor:pointer;
            padding:8px 12px;
            border-radius:6px;
            border:1px solid #dfe3e6;
            background:#f1f3f5;
            color:#212529;
        }

        .preview-box {
            display:none;
            width:160px;
            height:160px;
            border-radius:8px;
            overflow:hidden;
            background:#f3f3f3;
            border:1px solid #e1e1e1;
        }

        .preview-box img {
            width:100%;
            height:100%;
            object-fit:cover;
        }

        @media (max-width: 900px) {
            .hero-inner { flex-direction:column; }
            .slider-fixed {
                position:relative;
                width:100%;
                max-width:100%;
                height:280px;
                margin-left:0;
                margin-top:12px;
            }
        }
    </style>
</head>

<body>

<header class="site-header">
    <div class="container-inner">
        <h1 class="brand">Tomato Leaf Disease Detector</h1>
        <nav>
            <a href="/">Home</a>
            <a href="/details">Details & Remedies</a>
            <a href="/metrics">Model Metrics</a>
            <a href="/history">History</a>
        </nav>
    </div>
</header>

<main class="hero">
    <div class="hero-inner container-inner" style="display:flex; gap:20px; align-items:flex-start;">

        <!-- LEFT SIDE -->
        <div class="upload-card" style="flex:1;">
            <h2>Upload a leaf image</h2>
            <p class="muted">Supports .png, .jpg, .jpeg</p>

            <form id="uploadForm" action="/predict" method="POST" enctype="multipart/form-data">

                <!-- Gallery Input -->
                <input type="file"
                       id="galleryInput"
                       name="gallery_image"
                       accept="image/*"
                       class="file-input">

                <!-- Camera Input -->
                <input type="file"
                       id="cameraInput"
                       name="camera_image"
                       accept="image/*"
                       capture="environment"
                       class="file-input">

                <label for="galleryInput"
                       class="file-select-btn"
                       style="margin-top:8px; display:inline-block">
                    üìÅ Select Image
                </label>

                <label for="cameraInput"
                       class="btn-secondary"
                       style="margin-top:8px; display:inline-block; margin-left:8px;">
                    üì∏ Take Photo
                </label>

                <p id="fileName" class="muted" style="margin-top:8px"></p>

                <div style="margin-top:10px;display:flex;gap:12px;align-items:center">
                    <div id="previewContainer" class="preview-box">
                        <img id="previewImage" src="">
                    </div>
                </div>

                <div class="action-row">
                    <button class="btn-primary" type="submit">Predict</button>
                </div>

            </form>
            <p class="muted">
                Quickly identify common tomato leaf diseases and get treatment guidance.
            </p>
        </div>

        <!-- RIGHT SIDE SLIDER -->
        <div class="slider-fixed">
            <div class="slider-track" id="sliderTrack">
                <img src="{{ url_for('static', filename='image1.jpg') }}">
                <img src="{{ url_for('static', filename='image2.jpg') }}">
                <img src="{{ url_for('static', filename='image3.jpg') }}">
                <img src="{{ url_for('static', filename='image4.jpg') }}">
                <img src="{{ url_for('static', filename='image5.jpg') }}">
                <img src="{{ url_for('static', filename='image6.jpg') }}">
            </div>
        </div>

    </div>

    <!-- Preview + Validation -->
    <script>
    (function(){
        var galleryInput = document.getElementById('galleryInput');
        var cameraInput = document.getElementById('cameraInput');
        var previewContainer = document.getElementById('previewContainer');
        var previewImage = document.getElementById('previewImage');
        var fileName = document.getElementById('fileName');
        var form = document.getElementById('uploadForm');

        function handleFile(input){
            var file = input.files[0];
            if(!file) return;

            previewImage.src = URL.createObjectURL(file);
            previewContainer.style.display = 'block';
            fileName.textContent = file.name;

            if(input.id === "galleryInput"){
                cameraInput.value = "";
            } else {
                galleryInput.value = "";
            }
        }

        galleryInput.addEventListener('change', function(){
            handleFile(this);
        });

        cameraInput.addEventListener('change', function(){
            handleFile(this);
        });

        form.addEventListener('submit', function(e){
            if(!galleryInput.files.length && !cameraInput.files.length){
                e.preventDefault();
                alert("Please select or capture an image first.");
            }
        });

    })();
    </script>

    <!-- Slider Script -->
    <script>
    (function(){
        var track = document.getElementById('sliderTrack');
        if (!track) return;

        var slides = track.querySelectorAll('img');
        slides[0].classList.add('active');
        var index = 0;

        setInterval(function(){
            slides[index].classList.remove('active');
            index = (index + 1) % slides.length;
            slides[index].classList.add('active');
        }, 2000);
    })();
    </script>

</main>

<footer class="site-footer">
    <div class="container-inner">
        <p>¬© Tomato Leaf Disease Detector ‚Äî Guidance for educational purposes only.</p>
    </div>
</footer>
<!-- Loading Overlay -->
<div id="loadingOverlay" style="
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.6);
    color:white;
    font-size:22px;
    align-items:center;
    justify-content:center;
    z-index:9999;
    flex-direction:column;">
    
    <div style="margin-bottom:15px">üîÑ Analyzing Leaf...</div>
    <div class="spinner"></div>
</div>

<style>
.spinner {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #17a2b8;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
<script>
document.getElementById("uploadForm").addEventListener("submit", function() {
    document.getElementById("loadingOverlay").style.display = "flex";
});
</script>
</body>
</html>